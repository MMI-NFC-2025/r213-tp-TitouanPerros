---
import Layout from '../../layouts/Layout.astro';
import OffreCard from '../../components/OffreCard.astro';
import { getOffres } from '../../backend.mjs';
const offres = await getOffres();
---
<Layout titre="Offres">
    <div class="p-4">
        <h1 class="text-3xl font-bold mb-4">Offres</h1>
        
        <div class="flex flex-wrap gap-4 mb-6 items-end">
            <button id="favori-button" class="bg-slate-600 rounded-lg text-white px-4 py-2 hover:bg-slate-700">
                Afficher les favoris
            </button>
            
            <a href="/offres/surface/80" class="bg-green-600 rounded-lg text-white px-4 py-2 hover:bg-green-700">
                Maisons > 80 m²
            </a>
            
            <div class="flex gap-2 items-end">
                <div>
                    <label for="surface-filter" class="block text-sm font-medium text-gray-700 mb-1">
                        Filtrer par surface (m²)
                    </label>
                    <input 
                        type="number" 
                        id="surface-filter" 
                        placeholder="Ex: 100"
                        class="border border-gray-300 rounded-lg px-3 py-2 w-32"
                    />
                </div>
                <button id="surface-button" class="bg-blue-600 rounded-lg text-white px-4 py-2 hover:bg-blue-700">
                    Filtrer
                </button>
                <a href="/offres" class="bg-gray-500 rounded-lg text-white px-4 py-2 hover:bg-gray-600">
                    Réinitialiser
                </a>
            </div>
        </div>
    </div>
<div class="px-4">
    {
        offres.map(offre => (
            <div class="offre" data-favori={offre.favori.toString()}>
                <OffreCard {...offre} />
            </div>
        ))
    }
</div>
<script>
    //@ts-nocheck
    const button = document.getElementById('favori-button');
    let showOnlyFavorites = false;
    
    button?.addEventListener('click', () => {
        showOnlyFavorites = !showOnlyFavorites;
        const offres = document.querySelectorAll('.offre');
        
        offres.forEach(offre => {
            const isFavori = offre.dataset.favori === 'true';
            
            if (showOnlyFavorites) {
                offre.style.display = isFavori ? 'block' : 'none';
                button.textContent = 'Afficher tout';
            } else {
                offre.style.display = 'block';
                button.textContent = 'Afficher les favoris';
            }
        });
    });

    // Filtre par surface
    const surfaceButton = document.getElementById('surface-button');
    const surfaceInput = document.getElementById('surface-filter');
    
    surfaceButton?.addEventListener('click', () => {
        const surface = surfaceInput?.value;
        if (surface && !isNaN(parseInt(surface))) {
            window.location.href = `/offres/surface/${surface}`;
        }
    });

    // Permettre de filtrer avec la touche Entrée
    surfaceInput?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            surfaceButton?.click();
        }
    });
</script>
</Layout>
